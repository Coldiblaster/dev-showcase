"use client";

import { AnimatePresence, motion, useInView } from "framer-motion";
import {
  ArrowRight,
  Braces,
  Calendar,
  Check,
  CheckCircle2,
  ChevronRight,
  Copy,
  FileCode2,
  Globe,
  Hash,
  Languages,
  Shield,
  Terminal,
  Users,
  XCircle,
} from "lucide-react";
import { useTranslations } from "next-intl";
import { useEffect, useMemo, useRef, useState } from "react";

import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Separator } from "@/components/ui/separator";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import type { DemoMessages } from "@/data/demo-messages";
import { getDemoMessages } from "@/data/demo-messages";
import { useI18nShowcaseData } from "@/data/i18n-showcase-data";
import {
  type Locale,
  localeCode,
  localeDisplayName,
  locales,
} from "@/lib/i18n";
// Tipagens explícitas para arrays do i18nPage
import type { Messages } from "@/lib/i18n/types";

type I18nPage = Messages["i18nPage"];
type WorkflowStep = I18nPage["workflow"]["steps"][number];
type ScriptItem = I18nPage["scripts"]["items"][number];
type BestPracticeDo = I18nPage["bestPractices"]["do"]["items"][number];
type BestPracticeDont = I18nPage["bestPractices"]["dont"]["items"][number];

function useSectionInView() {
  const ref = useRef(null);
  const isInView = useInView(ref, { once: true, margin: "-80px" });
  return { ref, isInView };
}

const fadeUp = {
  hidden: { opacity: 0, y: 30 },
  visible: { opacity: 1, y: 0 },
};

const stagger = {
  visible: { transition: { staggerChildren: 0.08 } },
};

/* ─── Code Copy Button ─── */
function CopyButton({ text }: { text: string }) {
  const [copied, setCopied] = useState(false);
  return (
    <button
      onClick={() => {
        navigator.clipboard.writeText(text);
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
      }}
      className="absolute right-3 top-3 rounded-md border border-border/50 bg-background/50 p-1.5 text-muted-foreground transition-colors hover:text-foreground"
      aria-label="Copy code"
    >
      {copied ? (
        <Check className="h-3.5 w-3.5 text-primary" />
      ) : (
        <Copy className="h-3.5 w-3.5" />
      )}
    </button>
  );
}

/* ─── Code Block ─── */
function CodeBlock({ code, filename }: { code: string; filename?: string }) {
  return (
    <div className="relative overflow-hidden rounded-xl border border-border bg-card">
      {filename && (
        <div className="flex items-center gap-2 border-b border-border px-4 py-2.5">
          <div className="flex gap-1.5">
            <span className="h-3 w-3 rounded-full bg-destructive/60" />
            <span className="h-3 w-3 rounded-full bg-chart-4/60" />
            <span className="h-3 w-3 rounded-full bg-primary/60" />
          </div>
          <span className="font-mono text-xs text-muted-foreground">
            {filename}
          </span>
        </div>
      )}
      <CopyButton text={code} />
      <pre className="overflow-x-auto p-4 text-[13px] leading-relaxed">
        <code className="font-mono text-foreground/90">{code}</code>
      </pre>
    </div>
  );
}

/* ═══════════════════════════════
   1. HERO SECTION
   ═══════════════════════════════ */
function I18nHero({ onScrollToDemo }: { onScrollToDemo: () => void }) {
  const t = useTranslations("i18nPage");
  const { ref, isInView } = useSectionInView();

  return (
    <section
      ref={ref}
      className="relative flex min-h-[70vh] items-center overflow-hidden px-6 pt-28 pb-16"
    >
      {/* Grid bg */}
      <div
        className="pointer-events-none absolute inset-0 opacity-[0.03]"
        style={{
          backgroundImage:
            "url(\"data:image/svg+xml,%3Csvg width='40' height='40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h40v40H0z' fill='none' stroke='%23fff' stroke-width='.5'/%3E%3C/svg%3E\")",
        }}
      />

      <div className="mx-auto max-w-6xl">
        <motion.div
          initial="hidden"
          animate={isInView ? "visible" : "hidden"}
          variants={stagger}
          className="max-w-3xl"
        >
          <motion.div variants={fadeUp} transition={{ duration: 0.5 }}>
            <Badge className="mb-6 border-primary/30 bg-primary/10 text-primary">
              <Globe className="mr-1.5 h-3 w-3" />
              {t("hero.badge")}
            </Badge>
          </motion.div>

          <motion.h1
            variants={fadeUp}
            transition={{ duration: 0.5 }}
            className="mb-4 text-balance font-sans text-4xl font-bold tracking-tight text-foreground md:text-6xl"
          >
            {t("hero.title")}
          </motion.h1>

          <motion.p
            variants={fadeUp}
            transition={{ duration: 0.5 }}
            className="mb-4 text-lg text-primary font-medium"
          >
            {t("hero.subtitle")}
          </motion.p>

          <motion.p
            variants={fadeUp}
            transition={{ duration: 0.5 }}
            className="mb-8 max-w-2xl text-pretty leading-relaxed text-muted-foreground"
          >
            {t("hero.description")}
          </motion.p>

          <motion.div
            variants={fadeUp}
            transition={{ duration: 0.5 }}
            className="flex flex-wrap gap-3"
          >
            <Button onClick={onScrollToDemo} className="gap-2">
              {t("hero.ctaDemo")} <ArrowRight className="h-4 w-4" />
            </Button>
            <Button variant="outline" className="gap-2" asChild>
              <a
                href="https://next-intl.dev"
                target="_blank"
                rel="noopener noreferrer"
              >
                {t("hero.ctaDocs")}
              </a>
            </Button>
          </motion.div>
        </motion.div>
      </div>
    </section>
  );
}

/* ═══════════════════════════════
   2. LIVE DEMO
   ═══════════════════════════════ */
function LiveDemo() {
  const t = useTranslations("i18nPage");
  // O locale real pode ser obtido via next-intl, mas para demo mantemos "pt-BR" como default
  const locale: Locale = "pt-BR";
  const { ref, isInView } = useSectionInView();
  const [demoLocale, setDemoLocale] = useState<Locale>(locale);
  const [itemCount, setItemCount] = useState(5);
  const [name, setName] = useState("Vinicius");
  const [copied, setCopied] = useState(false);

  // Use real translations from messages/*/i18nPage.json for the preview
  const msgs = getDemoMessages(demoLocale);

  // Read initial state from query params (locale, count, name)
  useEffect(() => {
    try {
      const params = new URLSearchParams(window.location.search);
      const qLocale = params.get("locale");
      const qCount = params.get("count");
      const qName = params.get("name");

      if (qLocale && locales.includes(qLocale as Locale)) {
        setDemoLocale(qLocale as Locale);
      }
      if (qCount && !Number.isNaN(Number(qCount))) {
        setItemCount(Math.max(0, Number(qCount)));
      }
      if (qName) setName(qName);
    } catch (e) {
      // ignore
    }
  }, []);

  // Sync state to URL so it's shareable
  useEffect(() => {
    const params = new URLSearchParams();
    if (demoLocale) params.set("locale", demoLocale);
    if (typeof itemCount === "number") params.set("count", String(itemCount));
    if (name) params.set("name", name);
    const newUrl = `${window.location.pathname}?${params.toString()}`;
    window.history.replaceState({}, "", newUrl);
  }, [demoLocale, itemCount, name]);

  const demoDate = useMemo(() => {
    const localeMap: Record<Locale, string> = {
      "pt-BR": "pt-BR",
      en: "en-US",
      es: "es-ES",
      de: "de-DE",
    };
    return new Intl.DateTimeFormat(localeMap[demoLocale], {
      dateStyle: "long",
      timeStyle: "short",
    }).format(new Date());
  }, [demoLocale]);

  const demoNumber = useMemo(() => {
    const localeForNumber: Record<Locale, string> = {
      "pt-BR": "pt-BR",
      en: "en-US",
      es: "es-ES",
      de: "de-DE",
    };
    const currencyForLocale: Record<Locale, string> = {
      "pt-BR": "BRL",
      en: "USD",
      es: "EUR",
      de: "EUR",
    };

    // Base amount defined in BRL for demo purposes
    const baseAmountBRL = 1234567.89;

    // Static demo conversion rates (BRL -> target). These are approximations
    // and only for UI demonstration — replace with real API for production.
    const conversionFromBRL: Record<Locale, number> = {
      "pt-BR": 1, // BRL
      en: 0.2, // ~ 1 BRL = 0.20 USD
      es: 0.18, // ~ 1 BRL = 0.18 EUR
      de: 0.18,
    };

    const amount = baseAmountBRL * (conversionFromBRL[demoLocale] ?? 1);

    return new Intl.NumberFormat(localeForNumber[demoLocale], {
      style: "currency",
      currency: currencyForLocale[demoLocale] ?? "BRL",
    }).format(amount);
  }, [demoLocale]);

  function formatNumberForLocale(n: number, locale: Locale) {
    const localeMap: Record<Locale, string> = {
      "pt-BR": "pt-BR",
      en: "en-US",
      es: "es-ES",
      de: "de-DE",
    };
    return new Intl.NumberFormat(localeMap[locale]).format(n);
  }

  function interpolate(str: string, vars: Record<string, string | number>) {
    return Object.keys(vars).reduce((acc, key) => {
      const re = new RegExp(`\\{${key}\\}`, "g");
      return acc.replace(re, String(vars[key]));
    }, str);
  }

  function getPluralMessage(
    msgs: { items: string },
    count: number,
    locale: Locale,
  ) {
    // msgs.items expected in ICU-like: {count, plural, =0 {...} one {...} other {...}}
    const pattern = msgs.items || "{count, plural, other {{count}}}";

    // Extract the inner content after "{count, plural," and parse balanced-brace variants.
    const start = pattern.indexOf("{count");
    const openIndex = pattern.indexOf("plural", start);
    const variants: Record<string, string> = {};

    if (openIndex >= 0) {
      // Start parsing right after the 'plural' token, skipping spaces and commas.
      let i = openIndex + "plural".length;
      const n = pattern.length;
      while (i < n) {
        // skip whitespace and commas
        while (i < n && /[\s,]/.test(pattern[i])) i++;
        if (i >= n) break;

        // read variant key (e.g., =0, one, other)
        const keyMatch = pattern
          .slice(i)
          .match(/^(=\d+|zero|one|two|few|many|other)\b/);
        if (!keyMatch) break;
        const key = keyMatch[1];
        i += key.length;

        // skip whitespace and commas to opening brace
        while (i < n && /[\s,]/.test(pattern[i])) i++;
        // ensure we are at a '{' that starts the variant body
        while (i < n && pattern[i] !== "{") i++;
        if (i >= n || pattern[i] !== "{") break;

        // collect balanced brace content
        i++; // skip '{'
        let depth = 1;
        let buf = "";
        while (i < n && depth > 0) {
          const ch = pattern[i];
          if (ch === "{") {
            depth++;
            buf += ch;
            i++;
            continue;
          }
          if (ch === "}") {
            depth--;
            if (depth === 0) {
              i++; // consume closing brace and stop
              break;
            }
            buf += ch;
            i++;
            continue;
          }
          buf += ch;
          i++;
        }

        variants[key] = buf.trim();
      }
    }

    const localeMap: Record<Locale, string> = {
      "pt-BR": "pt-BR",
      en: "en-US",
      es: "es-ES",
      de: "de-DE",
    };

    const pr = new Intl.PluralRules(localeMap[locale]);
    const category = pr.select(count);

    let template =
      variants[`=${count}`] ??
      variants[category] ??
      variants.other ??
      "{count}";
    const formattedCount = formatNumberForLocale(count, locale);
    // replace ICU # or {count}
    template = template.replace(/#|\{count\}/g, String(formattedCount));
    return template;
  }

  const pluralResult = getPluralMessage(
    { items: msgs.items },
    itemCount,
    demoLocale,
  );

  return (
    <section ref={ref} id="live-demo" className="px-6 py-24">
      <div className="mx-auto max-w-6xl">
        <motion.div
          initial="hidden"
          animate={isInView ? "visible" : "hidden"}
          variants={stagger}
          className="mb-12 text-center"
        >
          <motion.h2
            variants={fadeUp}
            className="mb-2 text-3xl font-bold text-foreground md:text-4xl"
          >
            {t("liveDemo.title")}
          </motion.h2>
          <motion.p variants={fadeUp} className="text-muted-foreground">
            {t("liveDemo.subtitle")}
          </motion.p>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={isInView ? { opacity: 1, y: 0 } : {}}
          transition={{ duration: 0.6, delay: 0.2 }}
        >
          <Card className="overflow-hidden border-primary/20 bg-card">
            <CardContent className="p-0">
              <div className="grid gap-0 lg:grid-cols-[300px_1fr]">
                {/* Controls */}
                <div className="border-b border-border bg-secondary/30 p-6 lg:border-b-0 lg:border-r">
                  <p className="mb-4 text-xs font-semibold uppercase tracking-wider text-muted-foreground">
                    {t("liveDemo.selectLanguage")}
                  </p>
                  <div className="flex flex-col gap-2">
                    {locales.map((loc) => (
                      <button
                        key={loc}
                        onClick={() => setDemoLocale(loc)}
                        className={[
                          "flex items-center gap-3 rounded-lg px-4 py-3 text-left text-sm transition-all",
                          demoLocale === loc
                            ? "bg-primary/10 text-primary ring-1 ring-primary/30"
                            : "text-foreground hover:bg-secondary",
                        ].join(" ")}
                      >
                        <span className="font-mono text-xs text-muted-foreground">
                          {localeCode[loc]}
                        </span>
                        <span className="font-medium">
                          {localeDisplayName[loc]}
                        </span>
                        {demoLocale === loc && (
                          <CheckCircle2 className="ml-auto h-4 w-4" />
                        )}
                      </button>
                    ))}
                  </div>
                  <div className="mt-4">
                    {/* translation editor removed for simplification */}
                  </div>

                  <Separator className="my-6" />

                  <div className="mb-4">
                    <label className="mb-2 block text-xs font-semibold text-muted-foreground">
                      Nome (preview)
                    </label>
                    <Input
                      aria-label="Nome para saudacao"
                      value={name}
                      onChange={(e) => setName(e.target.value)}
                      className="w-full"
                    />
                  </div>

                  <div className="flex items-center">
                    <Button
                      size="sm"
                      variant="outline"
                      onClick={() => setItemCount(Math.max(0, itemCount - 1))}
                      className="h-8 min-w-8 p-0"
                      aria-label="Diminuir contador"
                    >
                      -
                    </Button>
                    <span className="w-10 text-center font-mono text-sm font-bold text-foreground">
                      {itemCount}
                    </span>
                    <Button
                      size="sm"
                      variant="outline"
                      onClick={() => setItemCount(itemCount + 1)}
                      className="h-8 min-w-8 p-0"
                      aria-label="Aumentar contador"
                    >
                      +
                    </Button>

                    <div className="ml-auto flex items-center gap-2">
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={async () => {
                          try {
                            await navigator.clipboard.writeText(
                              window.location.href,
                            );
                            setCopied(true);
                            setTimeout(() => setCopied(false), 2000);
                          } catch (e) {
                            // ignore
                          }
                        }}
                        aria-label="Copiar link da demo"
                      >
                        {copied ? "Link copiado" : "Copiar link"}
                      </Button>
                    </div>
                  </div>
                </div>

                {/* Preview */}
                <div className="p-6">
                  <div className="mb-4 flex items-center gap-2">
                    <div className="h-2 w-2 animate-pulse rounded-full bg-primary" />
                    <p className="text-xs font-semibold uppercase tracking-wider text-muted-foreground">
                      {t("liveDemo.preview")} &mdash;{" "}
                      {localeDisplayName[demoLocale]}
                    </p>
                  </div>

                  <AnimatePresence mode="wait">
                    <motion.div
                      key={demoLocale + itemCount}
                      initial={{ opacity: 0, x: 10 }}
                      animate={{ opacity: 1, x: 0 }}
                      exit={{ opacity: 0, x: -10 }}
                      transition={{ duration: 0.2 }}
                      className="space-y-5"
                    >
                      {/* Greeting */}
                      <div className="rounded-lg bg-secondary/50 p-4">
                        <p className="mb-1 text-xs text-muted-foreground">
                          {msgs.greeting}
                        </p>
                        <p className="text-lg font-semibold text-foreground">
                          {interpolate(msgs.greetingName, { name })}
                        </p>
                      </div>

                      {/* Welcome message */}
                      <p className="leading-relaxed text-foreground/80">
                        {msgs.welcomeMessage}
                      </p>

                      {/* Formatting grid */}
                      <div className="grid gap-3 sm:grid-cols-2">
                        <div className="rounded-lg border border-border p-3">
                          <div className="mb-1 flex items-center gap-1.5">
                            <Calendar className="h-3.5 w-3.5 text-primary" />
                            <p className="text-xs text-muted-foreground">
                              {msgs.dateLabel}
                            </p>
                          </div>
                          <p className="font-mono text-sm text-foreground">
                            {demoDate}
                          </p>
                        </div>
                        <div className="rounded-lg border border-border p-3">
                          <div className="mb-1 flex items-center gap-1.5">
                            <Hash className="h-3.5 w-3.5 text-primary" />
                            <p className="text-xs text-muted-foreground">
                              {msgs.numberLabel}
                            </p>
                          </div>
                          <p className="font-mono text-sm text-foreground">
                            {demoNumber}
                          </p>
                        </div>
                      </div>

                      {/* Pluralization */}
                      <div className="rounded-lg border border-primary/20 bg-primary/5 p-4">
                        <div className="mb-1 flex items-center gap-1.5">
                          <Users className="h-3.5 w-3.5 text-primary" />
                          <p className="text-xs text-muted-foreground">
                            {msgs.itemCountLabel}
                          </p>
                        </div>
                        <p className="text-lg font-semibold text-primary">
                          {pluralResult}
                        </p>
                      </div>
                    </motion.div>
                  </AnimatePresence>
                </div>
              </div>
            </CardContent>
          </Card>
        </motion.div>
      </div>
    </section>
  );
}

/* ═══════════════════════════════
   3. ARCHITECTURE
   ═══════════════════════════════ */
function Architecture() {
  const t = useTranslations("i18nPage");
  const { ref, isInView } = useSectionInView();

  const cards = [
    {
      icon: FileCode2,
      title: t("architecture.sourceOfTruth.title"),
      description: t("architecture.sourceOfTruth.description"),
    },
    {
      icon: Languages,
      title: t("architecture.autoTranslation.title"),
      description: t("architecture.autoTranslation.description"),
    },
    {
      icon: Braces,
      title: t("architecture.typeSafety.title"),
      description: t("architecture.typeSafety.description"),
    },
    {
      icon: Shield,
      title: t("architecture.qualityControl.title"),
      description: t("architecture.qualityControl.description"),
    },
  ];

  return (
    <section ref={ref} className="px-6 py-24 bg-secondary/20">
      <div className="mx-auto max-w-6xl">
        <motion.div
          initial="hidden"
          animate={isInView ? "visible" : "hidden"}
          variants={stagger}
          className="mb-12 text-center"
        >
          <motion.h2
            variants={fadeUp}
            className="mb-2 text-3xl font-bold text-foreground md:text-4xl"
          >
            {t("architecture.title")}
          </motion.h2>
          <motion.p variants={fadeUp} className="text-muted-foreground">
            {t("architecture.subtitle")}
          </motion.p>
        </motion.div>

        <motion.div
          initial="hidden"
          animate={isInView ? "visible" : "hidden"}
          variants={stagger}
          className="grid gap-4 sm:grid-cols-2"
        >
          {cards.map(({ icon: Icon, title, description }, i) => (
            <motion.div
              key={i}
              variants={fadeUp}
              transition={{ duration: 0.5 }}
            >
              <Card className="group h-full border-border/50 bg-card transition-all hover:border-primary/30 hover:shadow-lg hover:shadow-primary/5">
                <CardHeader className="pb-3">
                  <div className="mb-3 flex h-10 w-10 items-center justify-center rounded-xl bg-primary/10 transition-colors group-hover:bg-primary/20">
                    <Icon className="h-5 w-5 text-primary" />
                  </div>
                  <CardTitle className="text-base text-foreground">
                    {title}
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-sm leading-relaxed text-muted-foreground">
                    {description}
                  </p>
                </CardContent>
              </Card>
            </motion.div>
          ))}
        </motion.div>
      </div>
    </section>
  );
}

/* ═══════════════════════════════
   4. METHODS (with real code)
   ═══════════════════════════════ */
function Methods() {
  const t = useTranslations("i18nPage");
  const { ref, isInView } = useSectionInView();
  // useI18nShowcaseData now reads translations itself; call without passing a translator.
  const showcase = useI18nShowcaseData();
  return (
    <section ref={ref} className="px-6 py-24">
      <div className="mx-auto max-w-6xl">
        <motion.div
          initial="hidden"
          animate={isInView ? "visible" : "hidden"}
          variants={stagger}
          className="mb-12 text-center"
        >
          <motion.h2
            variants={fadeUp}
            className="mb-2 text-3xl font-bold text-foreground md:text-4xl"
          >
            {t("methods.title")}
          </motion.h2>
          <motion.p variants={fadeUp} className="text-muted-foreground">
            {t("methods.subtitle")}
          </motion.p>
        </motion.div>

        <Tabs defaultValue="useTranslations" className="w-full">
          <TabsList className="mb-8 flex w-full flex-wrap gap-2 bg-transparent h-auto">
            {showcase.map((m) => (
              <TabsTrigger
                key={m.title}
                value={m.title}
                className="gap-1.5 rounded-lg border border-border bg-card px-3 py-2 text-xs data-[state=active]:border-primary/50 data-[state=active]:bg-primary/10 data-[state=active]:text-primary"
              >
                {m.icon && <m.icon className="h-3.5 w-3.5" />}
                {m.title}
              </TabsTrigger>
            ))}
          </TabsList>

          {showcase.map((m) => (
            <TabsContent key={m.title} value={m.title}>
              <motion.div
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.3 }}
                className="grid gap-6 lg:grid-cols-[1fr_1.2fr]"
              >
                <div className="flex flex-col justify-center">
                  <Badge
                    variant="outline"
                    className="mb-4 w-fit border-primary/30 text-primary"
                  >
                    {m.badge}
                  </Badge>
                  <h3 className="mb-3 font-mono text-xl font-bold text-foreground">
                    {m.title}
                  </h3>
                  <p className="leading-relaxed text-muted-foreground">
                    {m.description}
                  </p>
                </div>
                <CodeBlock
                  code={m.code}
                  filename={
                    m.title.includes("(")
                      ? m.title.replace("()", ".tsx")
                      : "example.tsx"
                  }
                />
              </motion.div>
            </TabsContent>
          ))}
        </Tabs>
      </div>
    </section>
  );
}

/* ═══════════════════════════════
   5. WORKFLOW
   ═══════════════════════════════ */
function Workflow() {
  const t = useTranslations("i18nPage");
  const { ref, isInView } = useSectionInView();
  const steps: WorkflowStep[] = t.raw("workflow.steps");

  return (
    <section ref={ref} className="px-6 py-24 bg-secondary/20">
      <div className="mx-auto max-w-6xl">
        <motion.div
          initial="hidden"
          animate={isInView ? "visible" : "hidden"}
          variants={stagger}
          className="mb-12 text-center"
        >
          <motion.h2
            variants={fadeUp}
            className="mb-2 text-3xl font-bold text-foreground md:text-4xl"
          >
            {t("workflow.title")}
          </motion.h2>
          <motion.p variants={fadeUp} className="text-muted-foreground">
            {t("workflow.subtitle")}
          </motion.p>
        </motion.div>

        <div className="relative">
          {/* Vertical line */}
          <div className="absolute bottom-0 left-6 top-0 hidden w-px bg-border md:block lg:left-1/2" />

          <motion.div
            initial="hidden"
            animate={isInView ? "visible" : "hidden"}
            variants={stagger}
            className="flex flex-col gap-8"
          >
            {steps.map((step, i: number) => (
              <motion.div
                key={i}
                variants={fadeUp}
                transition={{ duration: 0.5 }}
                className={`relative flex flex-col gap-4 md:flex-row md:items-start ${
                  i % 2 === 0 ? "lg:flex-row" : "lg:flex-row-reverse"
                }`}
              >
                {/* Step indicator */}
                <div className="absolute left-6 hidden h-12 w-12 -translate-x-1/2 items-center justify-center rounded-full border-2 border-primary bg-background md:flex lg:left-1/2">
                  <span className="font-mono text-xs font-bold text-primary">
                    {step.step}
                  </span>
                </div>

                {/* Content */}
                <div
                  className={`flex-1 pl-0 md:pl-16 ${i % 2 === 0 ? "lg:pr-16 lg:pl-0 lg:text-right" : "lg:pl-16 lg:pr-0"}`}
                >
                  <Card className="border-border/50 bg-card">
                    <CardContent className="p-5">
                      <div
                        className={`flex items-center gap-2 ${i % 2 === 0 ? "lg:justify-end" : ""}`}
                      >
                        <span className="font-mono text-xs text-primary md:hidden">
                          {step.step}
                        </span>
                        <h3 className="font-semibold text-foreground">
                          {step.title}
                        </h3>
                      </div>
                      <p className="mt-2 text-sm leading-relaxed text-muted-foreground">
                        {step.description}
                      </p>
                      {step.command && (
                        <div className="mt-3 inline-flex items-center gap-2 rounded-lg bg-secondary px-3 py-1.5">
                          <Terminal className="h-3.5 w-3.5 text-primary" />
                          <code className="font-mono text-xs text-foreground">
                            {step.command}
                          </code>
                        </div>
                      )}
                    </CardContent>
                  </Card>
                </div>

                {/* Spacer for alternating */}
                <div className="hidden flex-1 lg:block" />
              </motion.div>
            ))}
          </motion.div>
        </div>
      </div>
    </section>
  );
}

/* ═══════════════════════════════
   6. SCRIPTS
   ═══════════════════════════════ */
function Scripts() {
  const t = useTranslations("i18nPage");
  const { ref, isInView } = useSectionInView();
  const items: ScriptItem[] = t.raw("scripts.items");

  return (
    <section ref={ref} className="px-6 py-24">
      <div className="mx-auto max-w-6xl">
        <motion.div
          initial="hidden"
          animate={isInView ? "visible" : "hidden"}
          variants={stagger}
          className="mb-12 text-center"
        >
          <motion.h2
            variants={fadeUp}
            className="mb-2 text-3xl font-bold text-foreground md:text-4xl"
          >
            {t("scripts.title")}
          </motion.h2>
          <motion.p variants={fadeUp} className="text-muted-foreground">
            {t("scripts.subtitle")}
          </motion.p>
        </motion.div>

        <motion.div
          initial="hidden"
          animate={isInView ? "visible" : "hidden"}
          variants={stagger}
          className="flex flex-col gap-3"
        >
          {items.map((item, i: number) => (
            <motion.div
              key={i}
              variants={fadeUp}
              transition={{ duration: 0.4 }}
            >
              <Card className="group border-border/50 bg-card transition-all hover:border-primary/30">
                <CardContent className="flex flex-col items-start gap-4 p-5 sm:flex-row sm:items-center">
                  <div className="flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-primary/10 transition-colors group-hover:bg-primary/20">
                    <Terminal className="h-5 w-5 text-primary" />
                  </div>
                  <div className="flex-1">
                    <code className="font-mono text-sm font-semibold text-foreground">
                      {item.command}
                    </code>
                    <p className="mt-1 text-sm text-muted-foreground">
                      {item.description}
                    </p>
                  </div>
                  <Badge
                    variant="outline"
                    className="shrink-0 border-primary/30 text-primary"
                  >
                    {item.badge}
                  </Badge>
                </CardContent>
              </Card>
            </motion.div>
          ))}
        </motion.div>
      </div>
    </section>
  );
}

/* ═══════════════════════════════
   7. BEST PRACTICES
   ═══════════════════════════════ */
function BestPractices() {
  const t = useTranslations("i18nPage");
  const { ref, isInView } = useSectionInView();
  const doItems: BestPracticeDo[] = t.raw("bestPractices.do.items");
  const dontItems: BestPracticeDont[] = t.raw("bestPractices.dont.items");

  return (
    <section ref={ref} className="px-6 py-24 bg-secondary/20">
      <div className="mx-auto max-w-6xl">
        <motion.div
          initial="hidden"
          animate={isInView ? "visible" : "hidden"}
          variants={stagger}
          className="mb-12 text-center"
        >
          <motion.h2
            variants={fadeUp}
            className="mb-2 text-3xl font-bold text-foreground md:text-4xl"
          >
            {t("bestPractices.title")}
          </motion.h2>
          <motion.p variants={fadeUp} className="text-muted-foreground">
            {t("bestPractices.subtitle")}
          </motion.p>
        </motion.div>

        <motion.div
          initial="hidden"
          animate={isInView ? "visible" : "hidden"}
          variants={stagger}
          className="grid gap-6 md:grid-cols-2"
        >
          {/* Do */}
          <motion.div variants={fadeUp}>
            <Card className="h-full border-primary/20 bg-card">
              <CardHeader className="pb-4">
                <CardTitle className="flex items-center gap-2 text-primary">
                  <CheckCircle2 className="h-5 w-5" />
                  {t("bestPractices.do.title")}
                </CardTitle>
              </CardHeader>
              <CardContent className="flex flex-col gap-3">
                {doItems.map((item, i: number) => (
                  <div key={i} className="flex items-start gap-3">
                    <ChevronRight className="mt-0.5 h-4 w-4 shrink-0 text-primary" />
                    <p className="text-sm leading-relaxed text-foreground/80">
                      {item}
                    </p>
                  </div>
                ))}
              </CardContent>
            </Card>
          </motion.div>

          {/* Don't */}
          <motion.div variants={fadeUp}>
            <Card className="h-full border-destructive/20 bg-card">
              <CardHeader className="pb-4">
                <CardTitle className="flex items-center gap-2 text-destructive">
                  <XCircle className="h-5 w-5" />
                  {t("bestPractices.dont.title")}
                </CardTitle>
              </CardHeader>
              <CardContent className="flex flex-col gap-3">
                {dontItems.map((item, i: number) => (
                  <div key={i} className="flex items-start gap-3">
                    <XCircle className="mt-0.5 h-4 w-4 shrink-0 text-destructive/60" />
                    <p className="text-sm leading-relaxed text-foreground/80">
                      {item}
                    </p>
                  </div>
                ))}
              </CardContent>
            </Card>
          </motion.div>
        </motion.div>
      </div>
    </section>
  );
}

/* ═══════════════════════════════
   8. FILE STRUCTURE
   ═══════════════════════════════ */
function FileStructure() {
  const t = useTranslations("i18nPage");
  const { ref, isInView } = useSectionInView();

  const tree = `messages/
├── pt-BR/              # Fonte de verdade
│   ├── index.ts        # Barrel export
│   ├── auth.json       # Autenticacao
│   ├── global.json     # Acoes, status, navegacao
│   ├── components.json # UI compartilhados
│   ├── errors.json     # Mensagens de erro
│   ├── admin/
│   │   ├── index.ts
│   │   └── user-management.json
│   ├── consultor/
│   │   ├── index.ts
│   │   └── business-unit.json
│   └── cockpit/
│       ├── index.ts
│       └── dashboard.json
├── en/                 # Gerado automaticamente
└── es/                 # Gerado automaticamente

src/i18n/
├── config.ts           # Locales suportados
├── routing.ts          # Config next-intl
├── request.ts          # Resolver locale (cookie)
├── load-messages.ts    # Carregar JSONs
└── types.d.ts          # TypeScript autocomplete`;

  return (
    <section ref={ref} className="px-6 py-24">
      <div className="mx-auto max-w-6xl">
        <motion.div
          initial="hidden"
          animate={isInView ? "visible" : "hidden"}
          variants={stagger}
          className="mb-12 text-center"
        >
          <motion.h2
            variants={fadeUp}
            className="mb-2 text-3xl font-bold text-foreground md:text-4xl"
          >
            {t("structure.title")}
          </motion.h2>
          <motion.p variants={fadeUp} className="text-muted-foreground">
            {t("structure.subtitle")}
          </motion.p>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={isInView ? { opacity: 1, y: 0 } : {}}
          transition={{ duration: 0.5, delay: 0.2 }}
          className="mx-auto max-w-3xl"
        >
          <p className="mb-6 text-center leading-relaxed text-muted-foreground">
            {t("structure.description")}
          </p>
          <CodeBlock code={tree} filename="Estrutura do projeto" />
        </motion.div>
      </div>
    </section>
  );
}

/* ═══════════════════════════════
   9. CTA
   ═══════════════════════════════ */
function CTASection() {
  const t = useTranslations("i18nPage");
  const { ref, isInView } = useSectionInView();

  return (
    <section ref={ref} className="px-6 py-24 bg-secondary/20">
      <motion.div
        initial={{ opacity: 0, y: 30 }}
        animate={isInView ? { opacity: 1, y: 0 } : {}}
        transition={{ duration: 0.6 }}
        className="mx-auto max-w-2xl text-center"
      >
        <h2 className="mb-4 text-3xl font-bold text-foreground">
          {t("cta.title")}
        </h2>
        <p className="mb-8 leading-relaxed text-muted-foreground">
          {t("cta.description")}
        </p>
        <Button size="lg" asChild className="gap-2">
          <a href="/">
            {t("cta.button")} <ArrowRight className="h-4 w-4" />
          </a>
        </Button>
      </motion.div>
    </section>
  );
}

/* ═════════════════════��═════════
   MAIN EXPORT
   ═══════════════════════════════ */
export function I18nShowcase() {
  const demoRef = useRef<HTMLDivElement>(null);
  const scrollToDemo = () =>
    demoRef.current?.scrollIntoView({ behavior: "smooth" });

  return (
    <div>
      <I18nHero onScrollToDemo={scrollToDemo} />
      <div ref={demoRef}>
        <LiveDemo />
      </div>
      <Architecture />
      <Methods />
      <Workflow />
      <Scripts />
      <BestPractices />
      <FileStructure />
      <CTASection />
    </div>
  );
}
